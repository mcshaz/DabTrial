(function(n){n.fn.columnFilter=function(t){function w(n,t,u,f,e){var s,o;if(typeof t=="undefined")return[];for(typeof u=="undefined"&&(u=!0),typeof f=="undefined"&&(f=!0),typeof e=="undefined"&&(e=!0),s=f==!0?n.aiDisplay:n.aiDisplayMaster,o=[],i=0,c=s.length;i<c;i++){var l=s[i],a=r.fnGetData(l),h=a[t];if(e==!0&&h.length==0)continue;else if(u==!0&&jQuery.inArray(h,o)>-1)continue;else o.push(h)}return o.sort()}function l(n){return e.bUseColVis?n:r.fnSettings().oApi._fnVisibleToColumnIndex(r.fnSettings(),n)}function b(t,r,f,e,s,c){var w="text_filter form-control",a,p;e&&(w="number_filter form-control"),o=o.replace(/(^\s*)|(\s*$)/g,"");var y=t.fnSettings().aoPreSearchCols[i].sSearch,b="search_init ",k=o;y!=""&&y!="^"&&(k=e&&y.charAt(0)=="^"?y.substr(1):y,b=""),a=n('<input type="text" class="'+b+w+'" value="'+k+'" rel="'+i+'"/>'),c!=undefined&&c!=-1&&a.attr("maxlength",c),u.html(a),e?u.wrapInner('<span class="filter_column filter_number" />'):u.wrapInner('<span class="filter_column filter_text" />'),v[i]=o,p=i,e&&!t.fnSettings().oFeatures.bServerSide?a.keyup(function(){t.fnFilter("^"+this.value,l(p),!0,!1),h()}):a.keyup(function(){var e,i,u;if(t.fnSettings().oFeatures.bServerSide&&s!=0){if(e=t.fnSettings().aoPreSearchCols[p].sSearch,i=n(this).data("dt-iLastFilterLength"),typeof i=="undefined"&&(i=0),u=this.value.length,Math.abs(u-i)<s)return;n(this).data("dt-iLastFilterLength",u)}t.fnFilter(this.value,l(p),r,f),h()}),a.focus(function(){n(this).hasClass("search_init")&&(n(this).removeClass("search_init"),this.value="")}),a.blur(function(){this.value==""&&(n(this).addClass("search_init"),this.value=v[p])})}function d(t){var r,o,f,s,e;u.html(y(0)),r=t.attr("id")+"_range_from_"+i,o=n('<input type="text" class="number_range_filter form-control" id="'+r+'" rel="'+i+'"/>'),u.append(o),u.append(y(1)),f=t.attr("id")+"_range_to_"+i,s=n('<input type="text" class="number_range_filter form-control" id="'+f+'" rel="'+i+'"/>'),u.append(s),u.append(y(2)),u.wrapInner('<span class="filter_column filter_number_range form-control" />'),e=i,a.push(i),t.dataTableExt.afnFiltering.push(function(n,i){if(t.attr("id")!=n.sTableId||document.getElementById(r)==null)return!0;var u=document.getElementById(r).value*1,o=document.getElementById(f).value*1,s=i[l(e)]=="-"?0:i[l(e)]*1;return u==""&&o==""?!0:u==""&&s<=o||u<=s&&""==o||u<=s&&s<=o?!0:!1}),n("#"+r+",#"+f,u).keyup(function(){var n=document.getElementById(r).value*1,i=document.getElementById(f).value*1;n!=0&&i!=0&&n>i||(t.fnDraw(),h())})}function g(t){var f=s.split(/[}{]/),r,y,o,p,c,v;for(u.html(""),y=t.attr("id")+"_range_from_"+i,o=n('<input type="text" class="date_range_filter form-control" id="'+y+'" rel="'+i+'"/>'),o.datepicker(),p=t.attr("id")+"_range_to_"+i,c=n('<input type="text" class="date_range_filter form-control" id="'+p+'" rel="'+i+'"/>'),r=0;r<f.length;r++)f[r]==e.sDateFromToken?u.append(o):f[r]==e.sDateToToken?u.append(c):u.append(f[r]);u.wrapInner('<span class="filter_column filter_date_range" />'),c.datepicker(),v=i,a.push(i),t.dataTableExt.afnFiltering.push(function(i,r){var f,e,u;if(t.attr("id")!=i.sTableId||(f=o.datepicker("getDate"),e=c.datepicker("getDate"),f==null&&e==null))return!0;u=null;try{if(r[l(v)]==null||r[l(v)]=="")return!1;u=n.datepicker.parseDate(n.datepicker.regional[""].dateFormat,r[l(v)])}catch(s){return!1}return u==null?!1:f==null&&u<=e?!0:f<=u&&e==null||f<=u&&u<=e?!0:!1}),n("#"+y+",#"+p,u).change(function(){t.fnDraw(),h()})}function k(t,r,u,e,o,s,c,l){var b,a,y,k,v,p;for(r==null&&(r=w(t.fnSettings(),u,!0,!1,!0)),b=u,a=t.fnSettings().aoPreSearchCols[i].sSearch,(a==null||a=="")&&(a=c),y='<select class="search_init select_filter form-control" rel="'+i+'"><option value="" class="search_init">'+o+"<\/option>",l&&(y='<select class="search_init select_filter form-control" rel="'+i+'" multiple>'),k=r.length,f=0;f<k;f++)typeof r[f]!="object"?(v="",(escape(r[f])==a||escape(r[f])==escape(a))&&(v="selected "),y+="<option "+v+' value="'+escape(r[f])+'">'+r[f]+"<\/option>"):(v="",s?(r[f].value==a&&(v="selected "),y+="<option "+v+'value="'+r[f].value+'">'+r[f].label+"<\/option>"):(escape(r[f].value)==a&&(v="selected "),y+="<option "+v+'value="'+escape(r[f].value)+'">'+r[f].label+"<\/option>"));p=n(y+"<\/select>"),e.html(p),e.wrapInner('<span class="filter_column filter_select" />'),l?p.change(function(){var i,u,r;n(this).val()!=""?n(this).removeClass("search_init"):n(this).addClass("search_init"),i=n(this).val(),u=[],i==null||i==[]?r="^(.*)$":(n.each(i,function(n,t){u.push(tt(t))}),r="^("+u.join("|")+")$"),t.fnFilter(r,b,!0,!1)}):(p.change(function(){n(this).val()!=""?n(this).removeClass("search_init"):n(this).addClass("search_init"),s?t.fnFilter(n(this).val(),u,s):t.fnFilter(unescape(n(this).val()),u),h()}),a!=null&&a!=""&&t.fnFilter(unescape(a),u))}function nt(n,t,r,f,e){var s=n.fnSettings();t!=null&&typeof t!="function"||s.sAjaxSource==""||s.oFeatures.bServerSide||s.aoDrawCallback.push({fn:function(i,u,o){return function(s){if(s.iDraw==2&&s.sAjaxSource!=null&&s.sAjaxSource!=""&&!s.oFeatures.bServerSide)return k(n,t&&t(s.aoData,s),l(i),u,o,r,f,e)}}(i,u,o),sName:"column_filter_"+i}),k(n,typeof t=="function"?null:t,l(i),u,o,r,f,e)}function tt(n){return n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function it(t){for(var h=i,s='<div class="dropdown select_filter form-control"><a class="dropdown-toggle" data-toggle="dropdown" href="#">'+o+'<b class="caret"><\/b><\/a><ul class="dropdown-menu" role="menu"><li data-value=""><a>Show All<\/a><\/li>',c=t.length,e,f=0;f<c;f++)s+='<li data-value="'+t[f]+'"><a>'+t[f]+"<\/a><\/li>";e=n(s+"<\/ul><\/div>"),u.html(e),u.wrapInner('<span class="filterColumn filter_select" />'),e.find("li").click(function(){r.fnFilter(n(this).data("value"),h)})}function rt(t,r){var b,d,rt,nt,y,tt,ft;r==null&&(r=w(t.fnSettings(),i,!0,!0,!0));var it=i,c="",f,p=r.length,s=o.replace("%","Perc").replace("&","AND").replace("$","DOL").replace("Â£","STERL").replace("@","AT").replace(/\s/g,"_");s=s.replace(/[^a-zA-Z 0-9]+/g,""),b=o,(e.sFilterButtonText!=null||e.sFilterButtonText!=undefined)&&(b=e.sFilterButtonText);var k=12,l=Math.floor(p/k);p%k>0&&(l=l+1),d=100/l-2,rt=10*l,l==1&&(d=20);var ut='<div style="float:left; min-width: '+d+'%; " >',g=t.attr("id")+s,v="chkBtnOpen"+g,a=g+"-flt-toggle";for(c+='<button id="'+v+'" class="checkbox_filter btn btn-default" > '+b+"<\/button>",c+='<div id="'+a+'" title="'+o+'" rel="'+i+'" class="toggle-check ui-widget-content ui-corner-all"  style="width: '+rt+'%; " >',c+=ut,f=0;f<p;f++)f%k==0&&f!=0&&(c+="<\/div>"+ut),nt=r[f],y=r[f],typeof r[f]=="object"&&(nt=r[f].label,y=r[f].value),c+='<input class="search_init checkbox_filter btn btn-default" type="checkbox" id= "'+g+"_cb_"+y+'" name= "'+s+'" value="'+y+'" >'+nt+"<br/>",tt=n(c),u.html(tt),u.wrapInner('<span class="filter_column filter_checkbox" />'),tt.change(function(){var i="",r="|",u=n('input:checkbox[name="'+s+'"]:checked').size();n('input:checkbox[name="'+s+'"]:checked').each(function(t){(t==0&&u==1||t!=0&&t==u-1)&&(r=""),i=i.replace(/^\s+|\s+$/g,""),i=i+n(this).val()+r,r="|"}),i!=""?n('input:checkbox[name="'+s+'"]').removeClass("search_init"):n('input:checkbox[name="'+s+'"]').addClass("search_init"),t.fnFilter(i,it,!0,!1),h()});n("#"+v).button(),n("#"+a).dialog({autoOpen:!1,hide:"blind",buttons:[{text:"Reset",click:function(){return n('input:checkbox[name="'+s+'"]:checked').each(function(){n(this).attr("checked",!1),n(this).addClass("search_init")}),t.fnFilter("",it,!0,!1),h(),!1}},{text:"Close",click:function(){n(this).dialog("close")}}]}),n("#"+v).click(function(){n("#"+a).dialog("open");var t=n(this);return n("#"+a).dialog("widget").position({my:"top",at:"bottom",of:t}),!1}),ft=h,h=function(){var t=n("#"+v);n("#"+a).dialog("widget").position({my:"top",at:"bottom",of:t}),ft()}}function y(n){switch(n){case 0:return s.substring(0,s.indexOf("{from}"));case 1:return s.substring(s.indexOf("{from}")+6,s.indexOf("{to}"));default:return s.substring(s.indexOf("{to}")+4)}}var v,i,o,u,f,s="From {from} to {to}",p=[],a=[],h=function(){},r=this,e=n.extend({sPlaceHolder:"foot",sRangeSeparator:"~",iFilteringDelay:500,aoColumns:null,sRangeFormat:"From {from} to {to}",sDateFromToken:"from",sDateToToken:"to"},t);return this.each(function(){var t,w,c;if(r.fnSettings().oFeatures.bFilter){v=[];var h=r.fnSettings().aoFooter[0],l=r.fnSettings().nTFoot,y="tr";for(e.sPlaceHolder=="head:after"?(t=n("tr:first",r.fnSettings().nTHead).detach(),r.fnSettings().bSortCellsTop?(t.prependTo(n(r.fnSettings().nTHead)),h=r.fnSettings().aoHeader[1]):(t.appendTo(n(r.fnSettings().nTHead)),h=r.fnSettings().aoHeader[0]),y="tr:last",l=r.fnSettings().nTHead):e.sPlaceHolder=="head:before"&&(r.fnSettings().bSortCellsTop?(t=n("tr:first",r.fnSettings().nTHead).detach(),t.appendTo(n(r.fnSettings().nTHead)),h=r.fnSettings().aoHeader[1]):h=r.fnSettings().aoHeader[0],y="tr:first",l=r.fnSettings().nTHead),n(h).each(function(t){i=t;var f={type:"text",bRegex:!1,bSmart:!0,iMaxLenght:-1,iFilterLength:0};if(e.aoColumns!=null){if(e.aoColumns.length<i||e.aoColumns[i]==null)return;f=e.aoColumns[i]}if(o=n(n(this)[0].cell).text(),f.sSelector==null?u=n(n(this)[0].cell):(u=n(f.sSelector),u.length==0&&(u=n(n(this)[0].cell))),f!=null){s=f.sRangeFormat!=null?f.sRangeFormat:e.sRangeFormat;switch(f.type){case"null":break;case"number":b(r,!0,!1,!0,f.iFilterLength,f.iMaxLenght);break;case"select":f.bRegex!=!0&&(f.bRegex=!1),nt(r,f.values,f.bRegex,f.selected,f.multiple);break;case"number-range":d(r);break;case"date-range":g(r);break;case"checkbox":rt(r,f.values);break;case"twitter-dropdown":case"dropdown":it(f.values);break;case"text":default:f.bRegex=f.bRegex==null?!1:f.bRegex,f.bSmart=f.bSmart==null?!1:f.bSmart,b(r,f.bRegex,f.bSmart,!1,f.iFilterLength,f.iMaxLenght)}}}),f=0;f<a.length;f++)w=function(){var t=r.attr("id");return n("#"+t+"_range_from_"+a[f]).val()+e.sRangeSeparator+n("#"+t+"_range_to_"+a[f]).val()},p.push(w);r.fnSettings().oFeatures.bServerSide&&(c=r.fnSettings().fnServerData,r.fnSettings().fnServerData=function(t,i,u){var o,s;for(f=0;f<a.length;f++)for(s=a[f],o=0;o<i.length;o++)i[o].name=="sSearch_"+s&&(i[o].value=p[f]());if(i.push({name:"sRangeSeparator",value:e.sRangeSeparator}),c!=null)try{c(t,i,u,r.fnSettings())}catch(h){c(t,i,u)}else n.getJSON(t,i,function(n){u(n)})})}})}})(jQuery)