function onShowAutoWidthDialog(n){var t=n.parent(),i=n.width();t.find(".ui-dialog-titlebar").each(function(){jQuery(this).width(i)}),t.removeClass("autoWidthDialog").width(i+26),n.dialog("option","position","center"),jQuery("body").css("overflow","hidden"),jQuery(".ui-widget-overlay").css("width","100%")}function onHideAutoWidthDialog(n){var t=n.parent();t.find(".ui-dialog-titlebar").each(function(){jQuery(this).css("width","")}),t.addClass("autoWidthDialog"),jQuery("body").css("overflow","auto")}function showDetail(){var n=$(this),t=n.children().filter("option[value="+this.value+"]:first").data("detail");$("#"+n.attr("detaildisplayid")).html(t||"")}function displayAjaxFormDialog(n){var t=$(document.forms).filter("#ajaxForm").html(""),i=$("#ajaxFormDialog").html(n),r=$("form").hasAncestor(i),u=removeProperty(r.getAttributes(),"id","name","method","data-ajax","data-ajax-loading","novalidate");return t.removeAttr(t.getAttributes({nameOnly:!0}).remove("id","name","method","data-ajax","data-ajax-loading","novalidate").join(" ")).attr(u),r.children().appendTo(t),r.replaceWith(t),setDialogHeader(i),setElementListeners.call(i),t.removeData("validator"),t.removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse(t),i.dialog("open"),!1}function failedAjaxDelete(n,t){var r=$(".rowInEditor").addClass("field-validation-error").closest("#ajaxResultDialog,#ajaxFormDialog"),i=parseInt(t.toString().substring(1)),u="Failed to delete the selected row"+(i==4?", usually because the information has changed since the page was downloaded.":" because of a server error (which has been logged).");if(r.length){if(i==4){alert(u+" After clicking OK the window will be closed. Please reopen to see updated information"),r.dialog("close");return}}else i==4&&(alert(" After clicking OK the page will be reloaded."),location.reload());alert(u)}function displayAjaxResultDialog(n){var t=$("#ajaxResultDialog").html(n);return setDialogHeader(t),$("#ajaxFormDialog").dialog("close"),setElementListeners.call(t),t.dialog("open"),!1}function setDialogHeader(n){var t=n.find("h1,h2,h3").first(),i=$("#ui-dialog-title-"+n[0].id),r=t.contents();r.length?i.html("").append(r):i.html("&nbsp;"),t.remove()}function emptyFormElements(){var i=/\bmaintainState\b/,n=$("input"),t=[];n.each(function(n,i){i.type==="checkbox"&&i.name&&$.inArray(i.name,t)===-1&&t.push(i.name)}),n=n.filter(function(){return this.type!="hidden"||this.getAttribute("data-datatype")=="primarykey"||!$.inArray(this.Name,t)}),clearFormErrors(),n=n.add($("select,textarea")),n.each(function(){this.form&&this.type!=="submit"&&(this.getAttribute("data-datatype")=="primarykey"?this.value="-1":i.test(this.className)||(this.isEncrypted&&(this.isEncrpted=this.disabled=!1),$(this).emptyValues()),this.getAttribute("details")&&showDetail.call(this))})}function clearFormErrors(){$(".validation-summary-errors").find("li").remove(),$(".field-validation-error").removeClass("field-validation-error").addClass("field-validation-valid"),$(".input-validation-error").removeClass("input-validation-error")}function rowDeleted(){var n=$(".deleteRow"),t=n.closest("table");(n.hasClass("rowInEditor")&&emptyFormElements(),n.length!==0)&&(t.hasClass("dataTable")?t.dataTable().fnDeleteRow(n[0]):n.remove())}function populateFormElements(n){var r=/\bhasDatepicker\b/,t=/^\/Date\((\d+)\)\/$/,i=$($.formCtrlTagNames);clearFormErrors(),i.each(function(){var u,f,o,e=this.tagName.toLowerCase()=="input"?(this.type||"").toLowerCase():"";if(this.form&&this.name&&e!="submit"&&(u=n[this.name],typeof u!="undefined")&&(e!=="hidden"||u!==!0&&u!==!1||!i.is("input[type=checkbox][name='"+this.name+"'],input[type=radio][name='"+this.name+"']"))){if(u===null&&(u=""),t.test(u))u=new Date(parseInt(t.exec(u)[1])),r.test(this.className)?(o=$(this),f=$(this).datepicker("getDate")!=u,$(this).datepicker("setDate",u)):(f=this.value!=u.toLocaleDateString(),this.value=u.toLocaleDateString()),f&&(o||$(this)).change();else{if(e=="checkbox"||e=="radio"){e=="checkbox"?(f=this.checked!=u,this.checked=u):e=="radio"&&(f=this.checked!=(this.value==u),this.checked=this.value==u),f&&$(this).change(),this.disabled&&(this.checked=!1);return}f=this.value!=u,this.value=u,u=="Encrypted"?this.disabled=this.isEncrypted=!0:this.isEncrypted&&(this.disabled=this.isEncrypted=!1),this.getAttribute("details")&&showDetail.call(this)}f&&(o||$(this)).change()}})}function appendSelect(n){return isJsonError(response)?(displayJsonError(response),!1):($("#"+n.target).append("<option selected='selected' value='"+n.selectItem.value+"'>"+n.selectItem.text+"<\/option>"),$("#ajaxFormDialog").dialog("close"),!0)}function getValidationSummary(){var n=$(".validation-summary-errors > ul");return n.length==0&&(n=$("<div class='validation-summary-errors'><ul><\/ul><\/div>").insertBefore($("fieldset").has("input")[0]).find("ul")),n}function handleErrorResponse(){alert("Appologies - the server has returned an unexpected error. The window will be reloaded. If the error persists after reloading and data is resubmitted, please contact a website administrator."),location.reload()}function isJsonError(n){return n&&n.Tag=="ValidationError"}function displayJsonError(n,t,i){var r;return isJsonError(n)?(r=i||getValidationSummary(),r.html(""),$.each(n.State,function(n,t){var i,u="",f="";(t.Name&&(i=$(".field-validation-valid,.field-validation-error").filter("[data-valmsg-for='"+t.Name+"']").removeClass("field-validation-valid").addClass("field-validation-error"),$("input[name='"+t.Name+"']").addClass("input-validation-error"),u=$("label[for='"+t.Name+"']").textNotChild(),u&&(u+=": ")),i&&i.length&&(i.text(t.Errors.shift()),!t.Errors.length))||($.each(t.Errors,function(n,t){f+="<li>"+u+t+"<\/li>"}),r.append(f))}),!0):!1}function ajaxRedraw(n){if(isJsonError(n))displayJsonError(n);else{emptyFormElements();var t=$.fn.dataTable.fnTables(!0);t.length&&$(t[t.length-1]).dataTable().fnDraw()}}function ajaxAddOrChangeRow(n){if(isJsonError(n))return displayJsonError(n),!1;var t=$(".rowInEditor"),u=$(".ajaxUpdatableTBody").filter(":visible").last(),i=u.parent(),r;return emptyFormElements(),$.fn.dataTable.fnIsDataTable(i)?(r=$.type(n)=="string"?$.map($(n).find("td"),function(n){return $.trim(n.innerHTML)}):n,t.length>0?i.dataTable().fnUpdate(r,t[0]):i.dataTable().fnAddData(r)):t.length>0?t.replaceWith(n):u.prepend(n),t.removeClass("rowInEditor"),!0}function closeAndAddOrChangeRow(n){ajaxAddOrChangeRow(n)&&closeAjaxFormDialog(n)}function closeAjaxFormDialog(n){return isJsonError(n)?(displayJsonError(n),!1):(n&&n.redirectUrl?window.location.href=n.redirectUrl:$("#ajaxFormDialog").dialog("close"),!0)}function GetAntiForgeryToken(){var n=$("input[type='hidden'][name$='RequestVerificationToken']");return n.length==0?null:{name:n[0].name,value:n[0].value}}function setToggleVis(n){var i=$(this),t=$("."+i.data("toggleclass")),r=n&&n.data&&n.data.duration?n.data.duration:400;r==="instant"?i.prop("checked")?t.show():t.hide():i.prop("checked")?t.slideDown(r):t.slideUp(r)}function setElementListeners(){var t=function(n,t){return $.trim(n.value)&&t.selectedYear!=0&&t.selectedMonth!=0&&t.selectedDay!=0?{defaultDate:new Date(t.selectedYear,t.selectedMonth,t.selectedDay)}:{defaultDate:new Date}},n=this==window?document:this,i;$.datepicker&&(i=function(){var n=$("#ui-datepicker-div").is(":visible");$(this).datepicker(n?"hide":"show")},$(".date",n).not("[type=hidden]").add("input[type=date]").datepicker({beforeShow:t}),$.timepicker&&$(".dateTime",n).not("[type=hidden]").datetimepicker({timeFormat:"HH:mm",hour:(new Date).getHours(),beforeShow:t})),$(".toggleElements",n).each(function(){setToggleVis.call(this,{data:{duration:"instant"}});$(this).on("click",setToggleVis)});$("select",n).filter("[details='true']").each(showDetail).on("change",showDetail);Modernizr.input.placeholder||$("input,textarea",n).placeholder();$(".ajaxUpdatableTBody",n).on("click",".deleteAction",function(){$(".deleteRow").removeClass("deleteRow"),$(this).closest("tr").addClass("deleteRow")}).on("click",".editLink",function(){$(".rowInEditor").removeClass("rowInEditor"),$(this).closest("tr").addClass("rowInEditor")})}function removeProperty(n){var t=arguments,i;if($.isArray(n))return removeFromArray.apply(n,t);for(i=t.length;i>1;)delete n[t[--i]];return n}Array.prototype.remove=Array.prototype.remove||function(){for(var n=arguments.length,t,i;n&&this.length;)for(i=arguments[--n];(t=$.inArray(i,this))!=-1;)this.splice(t,1);return this},function(n){function t(n,t){for(var r=[],i=n.firstChild;i;i=i.nextSibling)i.nodeType==3&&r.push(i.nodeValue);return r.join(t)}n.fn.textNotChild=function(i,r){return arguments.length<2&&(r=""),arguments.length<1&&(i=""),n.map(this,function(n){return t(n,r)}).join(i)},n.fn.getAttributes=function(){var u=arguments.length&&arguments[0]!==!1&&arguments[0].nameOnly!==!1,i=this[0],r,n,t;if(!i)return this;if(u)for(r=[],n=0;n<i.attributes.length;n++)t=i.attributes[n],t.specified&&r.push(t.name);else for(r={},n=0;n<i.attributes.length;n++)t=i.attributes[n],t.specified&&(r[t.name]=t.value);return r},n.fn.mergeAttributes=function(t){var i;return(t instanceof jQuery?i=t.getAttributes():t.tagName?i=n(t).getAttributes():t&&(i=t),!i)?this:(delete i.id,this.each(function(){$this=n(this);for(var t in i)i.hasOwnProperty(t)&&$this.attr(t,i[t])}),this)},n.fn.hasAncestor=function(t){var i=t.jQuery?t:n(t);return this.filter(function(){return!!n(this).closest(t).length})},n.fn.isCheckable=function(){var t,n;if(this.length)return(t=this[0].tagName.toLowerCase(),t=="input")?(n=this[0].type.toLowerCase(),n==="checkbox"||n==="radio"):!1},n.fn.emptyValues=function(){return this.each(function(){var t=n(this),r,i;t.isCheckable()?(r=t.prop("checked"),i=t.prop("defaultChecked"),i!==r&&(t.prop("checked",i),t.change())):(r=t.val(),i="",i!==r&&(t.val(i),t.change()))}),this},n.ajaxPrefilter(function(n){var t;n.type.toLowerCase()!=="get"&&(t=GetAntiForgeryToken(),n.data.indexOf(t.name)===-1&&(n.data=n.data+"&"+t.name+"="+t.value))}),n.formCtrlTagNames="input,button,select,textarea"}(jQuery),function(n){var t,i,r,u;n.ajaxSetup({cache:!1}),n.datepicker&&(r={dateFormat:"d/m/yy"},Modernizr.input.placeholder||(r.onClose=function(){n(this).blur()}),n.datepicker.setDefaults(r)),n.fn.dataTable&&(u=n.fn.dataTable.fnTables(),n(".dataTable").filter(function(){return n.inArray(this,u)===-1}).dataTable()),yepnope({test:Modernizr.input.placeholder,nope:"/Scripts/jquery-placeholder.js",complete:setElementListeners});n(".emptyFields").on("click",function(t){t.preventDefault(),emptyFormElements(),n(".rowInEditor").removeClass("rowInEditor")});t=n("#ajaxResultDialog"),t.length&&(i=parseInt(n("fieldset").css("min-width"))||680,t.dialog({autoOpen:!1,minWidth:i,height:"auto",close:function(){n("#ajaxFormDialog").dialog("close")}}),n("#ajaxFormDialog").dialog({autoOpen:!1,minWidth:i,height:"auto",modal:!0,close:function(t){t.originalEvent&&n(t.originalEvent.target).closest(".ui-dialog-titlebar-close").length&&n(".rowInEditor").removeClass("rowInEditor")}})),n(".enabledif").each(function(){var t=n(this),f=t.data("enabledif"),s=function(n){var t,i,r;if(n.disabled)return null;switch(n.type){case"hidden":return;case"checkbox":if(n.value.toLowerCase()==="true"?t=!0:n.value.toLowerCase()==="false"&&(t=!1),n.checked)return t==="undefined"?n.value:t;if(t!=="undefined")return!t;break;case"radio":if(n.checked)return n.value;break;case"select":for(i=[],r=0;r<n.options.length;r++)if(n.options[r].selected)if(n.multiple)i.push(n.options[r].value);else return n.options[r].value;if(i.length===1)return i[0];if(i.length>1)return i;break;default:return n.value}},e=function(t,i){for(var u=!1,f,o=n.isArray(i)?i:[i],e,r=0;r<o.length;r++)for(f=0;f<t.length;f++)if(e=s(t[f]),u=n.isArray(e)?n.inArray(o[r],e)!==-1:e==o[r],u)return u;return u},i,r=n.map(f.propertyPairs,function(r){var u,f;if(r.name||r.name.length){u=r.name[0]=="#"?n(r.name):n(document.getElementsByName(r.name)).filter(function(n,i){return i.type&&i.type.toLowerCase()==="hidden"?!1:t[0].form?i.form===t[0].form:!0}),f=e(u,r.val);u.on("change",function(){f=e(u,r.val),i()});return function(){return f}}}),o=f.logicalOperator=="And",u=t.find(n.formCtrlTagNames).addBack(n.formCtrlTagNames);i=function(){for(var t=0,i=o,f;t<r.length;t++)if(o){if(r[t]()==!1){i=!1;break}}else if(r[t]()==!0){i=!0;break}for(f=n.map(u,function(n){return n.disabled}),u.prop("disabled",!i),t=0;t<f.length;t++)f[t]===i&&n(u[t]).change()},i()}),n(".partialmirror").each(function(){var i=n(this),f=i.data("partialmirror-watch"),e=new RegExp(i.data("partialmirror-regex")),r=function(){var n=e.exec(this.value);n&&n.length>1&&i.val(n[1])},t=n(document.getElementById(f)),u;if(!t.length&&(t=n(document.getElementsByName(f.replace(/_/g,"."))),!t.length)){console.log(f+" not found");return}if(u=(t[0].type||"").toLowerCase()=="file"?"change":"keyup",i.data("partialmirror-always"))t.on(u,r);else t.on("focus",function(){var n=i.val(),f=e.exec(this.value),o=this;if(!n||f&&f[1]==n){t.on(u,r);t.on("blur",function(){r.call(o),t.off(u,r)})}})}),n(".expando").each(function(){$t=n(this),$toggle=$t.find(".expandoToggle"),$slidingDiv=$t.next("div"),setClass=function(){$slidingDiv.is(":hidden")?$toggle.removeClass("expandoVisible").addClass("expandoHidden"):$toggle.removeClass("expandoHidden").addClass("expandoVisible")};$t.on("click",function(){$slidingDiv.slideToggle({complete:function(){setClass()}})});$t.hasClass("defaultOpen")||$slidingDiv.hide(),setClass()})}(jQuery)