(function(n){n.fn.columnFilter=function(t){function a(n,t,i,r,u){var s,f,e,h,c,o;if(typeof t=="undefined")return[];for(typeof i=="undefined"&&(i=!0),typeof r=="undefined"&&(r=!0),typeof u=="undefined"&&(u=!0),s=r==!0?n.aiDisplay:n.aiDisplayMaster,f=[],e=0,h=s.length;e<h;e++)if(iRow=s[e],c=oTable.fnGetData(iRow),o=c[t],u==!0&&o.length==0)continue;else if(i==!0&&jQuery.inArray(o,f)>-1)continue;else f.push(o);return f}function o(n){return properties.bUseColVis?n:oTable.fnSettings().oApi._fnVisibleToColumnIndex(oTable.fnSettings(),n)}function v(t,f,s,h,l){var p="text_filter",a,y;h&&(p="number_filter"),u=u.replace(/(^\s*)|(\s*$)/g,"");var v=t.fnSettings().aoPreSearchCols[i].sSearch,w="search_init ",b=u;v!=""&&v!="^"&&(b=h&&v.charAt(0)=="^"?v.substr(1):v,w=""),a=n('<input type="text" class="'+w+p+'" value="'+b+'"/>'),r.html(a),h?r.wrapInner('<span class="filter_column filter_number" />'):r.wrapInner('<span class="filter_column filter_text" />'),c[i]=u,y=i,h&&!t.fnSettings().oFeatures.bServerSide?a.keyup(function(){t.fnFilter("^"+this.value,o(y),!0,!1),e()}):a.keyup(function(){var u,i,r;if(t.fnSettings().oFeatures.bServerSide&&l!=0){if(u=t.fnSettings().aoPreSearchCols[y].sSearch,i=n(this).data("dt-iLastFilterLength"),typeof i=="undefined"&&(i=0),r=this.value.length,Math.abs(r-i)<l)return;n(this).data("dt-iLastFilterLength",r)}t.fnFilter(this.value,o(y),f,s),e()}),a.focus(function(){n(this).hasClass("search_init")&&(n(this).removeClass("search_init"),this.value="")}),a.blur(function(){this.value==""&&(n(this).addClass("search_init"),this.value=c[y])})}function w(t){var u,l,f,a,c;r.html(h(0)),u=t.attr("id")+"_range_from_"+i,l=n('<input type="text" class="number_range_filter" id="'+u+'" rel="'+i+'"/>'),r.append(l),r.append(h(1)),f=t.attr("id")+"_range_to_"+i,a=n('<input type="text" class="number_range_filter" id="'+f+'" rel="'+i+'"/>'),r.append(a),r.append(h(2)),r.wrapInner('<span class="filterColumn filter_number_range" />'),c=i,s.push(i),t.dataTableExt.afnFiltering.push(function(n,i){if(t.attr("id")!=n.sTableId)return!0;var r=document.getElementById(u).value*1,e=document.getElementById(f).value*1,s=i[o(c)]=="-"?0:i[o(c)]*1;return r==""&&e==""?!0:r==""&&s<=e||r<=s&&""==e||r<=s&&s<=e?!0:!1}),n("#"+u+",#"+f,r).keyup(function(){var n=document.getElementById(u).value*1,i=document.getElementById(f).value*1;n!=0&&i!=0&&n>i||(t.fnDraw(),e())})}function b(t){var l,u,a,f,c;r.html(h(0)),l=t.attr("id")+"_range_from_"+i,u=n('<input type="text" class="date_range_filter" id="'+l+'" rel="'+i+'"/>'),u.datepicker(),r.append(u),r.append(h(1)),a=t.attr("id")+"_range_to_"+i,f=n('<input type="text" class="date_range_filter" id="'+a+'" rel="'+i+'"/>'),r.append(f),r.append(h(2)),r.wrapInner('<span class="filterColumn filter_date_range" />'),f.datepicker(),c=i,s.push(i),t.dataTableExt.afnFiltering.push(function(i,r){var s,h,e;if(t.attr("id")!=i.sTableId||(s=u.datepicker("getDate"),h=f.datepicker("getDate"),s==null&&h==null))return!0;e=null;try{if(r[o(c)]==null||r[o(c)]=="")return!1;e=n.datepicker.parseDate(n.datepicker.regional[""].dateFormat,r[o(c)])}catch(l){return!1}return e==null?!1:s==null&&e<=h?!0:s<=e&&h==null||s<=e&&e<=h?!0:!1}),n("#"+l+",#"+a,r).change(function(){t.fnDraw(),e()})}function y(t,r,u,f,o){var h,l;r==null&&(r=a(t.fnSettings(),u,!0,!1,!0));for(var p=u,v=t.fnSettings().aoPreSearchCols[i].sSearch,c='<select class="search_init select_filter"><option value="" class="search_init">'+o+"<\/option>",s=0,y=r.length,s=0;s<y;s++)typeof r[s]!="object"?(h="",escape(r[s])==v&&(h="selected "),c+="<option "+h+' value="'+escape(r[s])+'">'+r[s]+"<\/option>"):(h="",escape(r[s].value)==v&&(h="selected "),c+="<option "+h+'value="'+escape(r[s].value)+'">'+r[s].label+"<\/option>");l=n(c+"<\/select>"),f.html(l),f.wrapInner('<span class="filterColumn filter_select" />'),l.change(function(){n(this).val()!=""?n(this).removeClass("search_init"):n(this).addClass("search_init"),t.fnFilter(unescape(n(this).val()),u),e()})}function d(n,t){var f=n.fnSettings();t!=null||f.sAjaxSource==""||f.oFeatures.bServerSide||f.aoDrawCallback.push({fn:function(t,i,r){return function(){if(f.iDraw==2&&f.sAjaxSource!=null&&f.sAjaxSource!=""&&!f.oFeatures.bServerSide)return y(n,null,o(t),i,r)}}(i,r,u),sName:"column_filter_"+i}),y(n,t,o(i),r,u)}function g(t,f){var w,d,b,tt;f==null&&(f=a(t.fnSettings(),i,!0,!0,!0));var k=i,h="",o,v=f.length,s=u.replace("%","Perc").replace("&","AND").replace("$","DOL").replace("ï¿½","STERL").replace("@","AT").replace(/\s/g,"_");s=s.replace(/[^a-zA-Z 0-9]+/g,""),labelBtn=properties.sFilterButtonText!=null||properties.sFilterButtonText!=undefined?properties.sFilterButtonText:u;var p=12,c=Math.floor(v/p);v%p>0&&(c=c+1),w=100/c-2,d=10*c,c==1&&(w=20);var g='<div style="float:left; min-width: '+w+'%; " >',nt=t.attr("id")+s,y="chkBtnOpen"+nt,l=nt+"-flt-toggle";for(h+='<button id="'+y+'" class="checkbox_filter" > '+labelBtn+"<\/button>",h+='<div id="'+l+'" title="'+u+'" class="toggle-check ui-widget-content ui-corner-all"  style="width: '+d+'%; " >',h+=g,o=0;o<v;o++)o%p==0&&o!=0&&(h+="<\/div>"+g),h+='<input class="search_init checkbox_filter" type="checkbox" id= "'+f[o]+'" name= "'+s+'" value="'+f[o]+'" >'+f[o]+"<br/>",b=n(h),r.html(b),r.wrapInner('<span class="filterColumn filter_checkbox" />'),b.change(function(){var i="",u="|",o=n('input:checkbox[name="'+s+'"]:checked').size(),r;for(n('input:checkbox[name="'+s+'"]:checked').each(function(t){(t==0&&o==1||t!=0&&t==o-1)&&(u=""),i=i.replace(/^\s+|\s+$/g,""),i=i+n(this).val()+u,u="|"}),r=0;r<v;r++)i!=""?n("#"+f[r]).removeClass("search_init"):n("#"+f[r]).addClass("search_init");t.fnFilter(i,k,!0,!1),e()});n("#"+y).button(),n("#"+l).dialog({autoOpen:!1,hide:"blind",buttons:[{text:"Reset",click:function(){return n('input:checkbox[name="'+s+'"]:checked').each(function(){n(this).attr("checked",!1),n(this).addClass("search_init")}),t.fnFilter("",k,!0,!1),e(),!1}},{text:"Close",click:function(){n(this).dialog("close")}}]}),n("#"+y).click(function(){n("#"+l).dialog("open");var t=n(this);return n("#"+l).dialog("widget").position({my:"top",at:"bottom",of:t}),!1}),tt=e,e=function(){var t=n("#"+y);n("#"+l).dialog("widget").position({my:"top",at:"bottom",of:t}),tt()}}function h(n){switch(n){case 0:return f.substring(0,f.indexOf("{from}"));case 1:return f.substring(f.indexOf("{from}")+6,f.indexOf("{to}"));default:return f.substring(f.indexOf("{to}")+4)}}var c,i,u,r,f="From {from} to {to}",l=[],s=[],e=function(){},p;return oTable=this,p={sPlaceHolder:"foot",sRangeSeparator:"~",iFilteringDelay:500,aoColumns:null,sRangeFormat:"From {from} to {to}"},properties=n.extend(p,t),this.each(function(){var e,t,h,o;if(oTable.fnSettings().oFeatures.bFilter){for(c=[],e="tfoot tr",properties.sPlaceHolder=="head:after"?(t=n("thead tr:last",oTable).detach(),oTable.fnSettings().bSortCellsTop?t.appendTo(n("thead",oTable)):t.prependTo(n("thead",oTable)),e="thead tr:last"):properties.sPlaceHolder=="head:before"&&(t=n("thead tr:first",oTable).detach(),oTable.fnSettings().bSortCellsTop?t.appendTo(n("thead",oTable)):t.prependTo(n("thead",oTable)),e="thead tr:first"),n(e+" th",oTable).each(function(t){i=t;var e={type:"text",bRegex:!1,bSmart:!0,iFilterLength:0};if(properties.aoColumns!=null){if(properties.aoColumns.length<i||properties.aoColumns[i]==null)return;e=properties.aoColumns[i]}if(u=n(this).text(),e.sSelector==null?r=n(n(this)[0]):(r=n(e.sSelector),r.length==0&&(r=n(n(this)[0]))),e!=null){f=e.sRangeFormat!=null?e.sRangeFormat:properties.sRangeFormat;switch(e.type){case"number":v(oTable,!0,!1,!0,e.iFilterLength);break;case"select":d(oTable,e.values);break;case"number-range":w(oTable);break;case"date-range":b(oTable);break;case"checkbox":g(oTable,e.values);break;case"text":default:bRegex=e.bRegex==null?!1:e.bRegex,bSmart=e.bSmart==null?!1:e.bSmart,v(oTable,bRegex,bSmart,!1,e.iFilterLength)}}}),j=0;j<s.length;j++)h=function(){var t=oTable.attr("id");return n("#"+t+"_range_from_"+s[j]).val()+properties.sRangeSeparator+n("#"+t+"_range_to_"+s[j]).val()},l.push(h);oTable.fnSettings().oFeatures.bServerSide&&(o=oTable.fnSettings().fnServerData,oTable.fnSettings().fnServerData=function(t,i,r){for(j=0;j<s.length;j++){var u=s[j];for(k=0;k<i.length;k++)i[k].name=="sSearch_"+u&&(i[k].value=l[j]())}if(i.push({name:"sRangeSeparator",value:properties.sRangeSeparator}),o!=null)try{o(t,i,r,oTable.fnSettings())}catch(f){o(t,i,r)}else n.getJSON(t,i,function(n){r(n)})})}})}})(jQuery)