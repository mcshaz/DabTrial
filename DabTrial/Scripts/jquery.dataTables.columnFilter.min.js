(function(n){n.fn.columnFilter=function(t){function a(n,t,i,r,u){var s,f,e,h,c,o;if(typeof t=="undefined")return[];for(typeof i=="undefined"&&(i=!0),typeof r=="undefined"&&(r=!0),typeof u=="undefined"&&(u=!0),s=r==!0?n.aiDisplay:n.aiDisplayMaster,f=[],e=0,h=s.length;e<h;e++)if(iRow=s[e],c=oTable.fnGetData(iRow),o=c[t],u==!0&&o.length==0)continue;else if(i==!0&&jQuery.inArray(o,f)>-1)continue;else f.push(o);return f}function e(n){return properties.bUseColVis?n:oTable.fnSettings().oApi._fnVisibleToColumnIndex(oTable.fnSettings(),n)}function v(t,o,s,h,l){var p="text_filter",a,y;h&&(p="number_filter"),u=u.replace(/(^\s*)|(\s*$)/g,"");var v=t.fnSettings().aoPreSearchCols[i].sSearch,w="search_init ",b=u;v!=""&&v!="^"&&(b=h&&v.charAt(0)=="^"?v.substr(1):v,w=""),a=n('<input type="text" class="'+w+p+'" value="'+b+'"/>'),r.html(a),h?r.wrapInner('<span class="filter_column filter_number" />'):r.wrapInner('<span class="filter_column filter_text" />'),c[i]=u,y=i,h&&!t.fnSettings().oFeatures.bServerSide?a.keyup(function(){t.fnFilter("^"+this.value,e(y),!0,!1),f()}):a.keyup(function(){var u,i,r;if(t.fnSettings().oFeatures.bServerSide&&l!=0){if(u=t.fnSettings().aoPreSearchCols[y].sSearch,i=n(this).data("dt-iLastFilterLength"),typeof i=="undefined"&&(i=0),r=this.value.length,Math.abs(r-i)<l)return;n(this).data("dt-iLastFilterLength",r)}t.fnFilter(this.value,e(y),o,s),f()}),a.focus(function(){n(this).hasClass("search_init")&&(n(this).removeClass("search_init"),this.value="")}),a.blur(function(){this.value==""&&(n(this).addClass("search_init"),this.value=c[y])})}function w(t){var c=t.fnSettings().aoPreSearchCols[i].sSearch,v="",y="",l,u,p,o,w,a;c!=""&&c!="undefined"&&(l=c.split("~"),v=l[0],y=l[1]),r.html(h(0)),u=t.attr("id")+"_range_from_"+i,p=n('<input type="text" class="number_range_filter" id="'+u+'" value="'+v+'" rel="'+i+'"/>'),r.append(p),r.append(h(1)),o=t.attr("id")+"_range_to_"+i,w=n('<input type="text" class="number_range_filter" id="'+o+'" value="'+y+'" rel="'+i+'"/>'),r.append(w),r.append(h(2)),r.wrapInner('<span class="filterColumn filter_number_range" />'),a=i,s.push(i),t.dataTableExt.afnFiltering.push(function(n,i){if(t.attr("id")!=n.sTableId)return!0;var r=document.getElementById(u).value*1,f=document.getElementById(o).value*1,s=i[e(a)]=="-"?0:i[e(a)]*1;return r==""&&f==""?!0:r==""&&s<=f||r<=s&&""==f||r<=s&&s<=f?!0:!1}),n("#"+u+",#"+o,r).keyup(function(){var n=document.getElementById(u).value*1,i=document.getElementById(o).value*1;n!=0&&i!=0&&n>i||(t.fnDraw(),f())})}function b(t){var l=t.fnSettings().aoPreSearchCols[i].sSearch,p="",w="",a,v,u,y,o,c;l!=""&&l!="undefined"&&(a=l.split("~"),p=a[0],w=a[1]),r.html(h(0)),v=t.attr("id")+"_range_from_"+i,u=n('<input type="text" class="date_range_filter" id="'+v+'" value="'+p+'" rel="'+i+'"/>'),u.datepicker(),r.append(u),r.append(h(1)),y=t.attr("id")+"_range_to_"+i,o=n('<input type="text" class="date_range_filter" id="'+y+'" value="'+w+'" rel="'+i+'"/>'),r.append(o),r.append(h(2)),r.wrapInner('<span class="filterColumn filter_date_range" />'),o.datepicker(),c=i,s.push(i),t.dataTableExt.afnFiltering.push(function(i,r){var s,h,f;if(t.attr("id")!=i.sTableId||(s=u.datepicker("getDate"),h=o.datepicker("getDate"),s==null&&h==null))return!0;f=null;try{if(r[e(c)]==null||r[e(c)]=="")return!1;f=n.datepicker.parseDate(n.datepicker.regional[""].dateFormat,r[e(c)])}catch(l){return!1}return f==null?!1:s==null&&f<=h?!0:s<=f&&h==null||s<=f&&f<=h?!0:!1}),n("#"+v+",#"+y,r).change(function(){t.fnDraw(),f()})}function y(t,r,u,e){var s,c;r==null&&(r=a(t.fnSettings(),u,!0,!1,!0));for(var y=u,l=t.fnSettings().aoPreSearchCols[i].sSearch,h='<select class="search_init select_filter"><option value="" class="search_init"><\/option>',o=0,v=r.length,o=0;o<v;o++)typeof r[o]!="object"?(s="","^"+escape(r[o])+"$"==l&&(s="selected "),h+="<option "+s+' value="'+escape("^"+r[o]+"$")+'">'+r[o]+"<\/option>"):(s="","^"+escape(r[o])+"$"==l&&(s="selected "),h+="<option "+s+'value="'+escape(r[o].value+"$")+'">'+r[o].label+"<\/option>");c=n(h+"<\/select>"),e.html(c),e.wrapInner('<span class="filterColumn filter_select" />'),c.change(function(){n(this).val()!=""?n(this).removeClass("search_init"):n(this).addClass("search_init"),t.fnFilter(unescape(n(this).val()),u),f()})}function d(n,t){var f=n.fnSettings();t!=null||f.sAjaxSource==""||f.oFeatures.bServerSide||f.aoDrawCallback.push({fn:function(t,i,r){return function(){if(f.iDraw==2&&f.sAjaxSource!=null&&f.sAjaxSource!=""&&!f.oFeatures.bServerSide)return y(n,null,e(t),i,r)}}(i,r,u),sName:"column_filter_"+i}),y(n,t,e(i),r,u)}function g(t,e){var w,g,b,it,rt,k,ut;e==null&&(e=a(t.fnSettings(),i,!0,!0,!0));var d=i,h="",o,v=e.length,s=u.replace("%","Perc").replace("&","AND").replace("$","DOL").replace("ï¿½","STERL").replace("@","AT").replace(/\s/g,"_");s=s.replace(/[^a-zA-Z 0-9]+/g,""),labelBtn=properties.sFilterButtonText!=null||properties.sFilterButtonText!=undefined?properties.sFilterButtonText:u||"filter";var p=12,c=Math.floor(v/p);v%p>0&&(c=c+1),w=100/c-2,g=10*c,c==1&&(w=20);var nt='<div style="float:left; min-width: '+w+'%; " >',tt=t.attr("id")+s,y="chkBtnOpen"+tt,l=tt+"-flt-toggle";for(h+='<button id="'+y+'" class="checkbox_filter" > '+labelBtn+"<\/button>",h+='<div id="'+l+'" title="'+u+'" class="toggle-check ui-widget-content ui-corner-all"  style="width: '+g+'%; " >',h+=nt,b=t.fnSettings().aoPreSearchCols[i].sSearch,it=b?b.split("|"):[],o=0;o<v;o++)o%p==0&&o!=0&&(h+="<\/div>"+nt),rt=n.inArray("^"+e[o]+"$",it)>-1,h+='<input class="search_init checkbox_filter" type="checkbox" id= "'+e[o]+'" name= "'+s+'" value="'+("^"+e[o]+"$")+'" '+(rt?'checked="checked"':"")+">"+e[o]+"<br/>",k=n(h),r.html(k),r.wrapInner('<span class="filterColumn filter_checkbox" />'),k.change(function(){var i="",u="|",o=n('input:checkbox[name="'+s+'"]:checked').size(),r;for(n('input:checkbox[name="'+s+'"]:checked').each(function(t){(t==0&&o==1||t!=0&&t==o-1)&&(u=""),i=i.replace(/^\s+|\s+$/g,""),i=i+n(this).val()+u,u="|"}),r=0;r<v;r++)i!=""?n("#"+e[r]).removeClass("search_init"):n("#"+e[r]).addClass("search_init");t.fnFilter(i,d,!0,!1),f()});n("#"+y).button(),n("#"+l).dialog({autoOpen:!1,buttons:[{text:"Reset",click:function(){return n('input:checkbox[name="'+s+'"]:checked').each(function(){n(this).attr("checked",!1),n(this).addClass("search_init")}),t.fnFilter("",d,!0,!1),f(),!1}},{text:"Close",click:function(){n(this).dialog("close")}}]}),n("#"+y).click(function(){n("#"+l).dialog("open");var t=n(this);return n("#"+l).dialog("widget").position({my:"top",at:"bottom",of:t}),!1}),ut=f,f=function(){var t=n("#"+y);n("#"+l).dialog("widget").position({my:"top",at:"bottom",of:t}),ut()}}function h(n){switch(n){case 0:return o.substring(0,o.indexOf("{from}"));case 1:return o.substring(o.indexOf("{from}")+6,o.indexOf("{to}"));default:return o.substring(o.indexOf("{to}")+4)}}var c,i,u,r,o="From {from} to {to}",l=[],s=[],f=function(){},p;return oTable=this,p={sPlaceHolder:"foot",sRangeSeparator:"~",iFilteringDelay:500,aoColumns:null,sRangeFormat:"From {from} to {to}"},properties=n.extend(p,t),this.each(function(){var f,t,a,e;if(oTable.fnSettings().oFeatures.bFilter){c=[],f="tfoot tr",properties.sPlaceHolder=="head:after"?(t=n("thead tr:last",oTable).detach(),oTable.fnSettings().bSortCellsTop?t.appendTo(n("thead",oTable)):t.prependTo(n("thead",oTable)),f="thead tr:last"):properties.sPlaceHolder=="head:before"&&(t=n("thead tr:first",oTable).detach(),oTable.fnSettings().bSortCellsTop?t.appendTo(n("thead",oTable)):t.prependTo(n("thead",oTable)),f="thead tr:first");var y=oTable.fnSettings().aoColumns,p=n(f+" th",oTable),h=-1;for(n(y).each(function(t){i=t;var f={type:"text",bRegex:!1,bSmart:!0,iFilterLength:0};if(properties.aoColumns!=null){if(properties.aoColumns.length<i||properties.aoColumns[i]==null)return;f=properties.aoColumns[i]}if(this.bVisible)h++;else if(f.sSelector==null)return;if(r=n(p[h]),f.sSelector!=null&&(r=n(f.sSelector)),u=r.text(),f!=null){o=f.sRangeFormat!=null?f.sRangeFormat:properties.sRangeFormat;switch(f.type){case"number":v(oTable,!0,!1,!0,f.iFilterLength);break;case"select":d(oTable,f.values);break;case"number-range":w(oTable);break;case"date-range":b(oTable);break;case"checkbox":g(oTable,f.values);break;case"text":default:bRegex=f.bRegex==null?!1:f.bRegex,bSmart=f.bSmart==null?!1:f.bSmart,v(oTable,bRegex,bSmart,!1,f.iFilterLength)}}}),j=0;j<s.length;j++)a=function(){var t=oTable.attr("id");return n("#"+t+"_range_from_"+s[j]).val()+properties.sRangeSeparator+n("#"+t+"_range_to_"+s[j]).val()},l.push(a);oTable.fnSettings().oFeatures.bServerSide&&(e=oTable.fnSettings().fnServerData,oTable.fnSettings().fnServerData=function(t,i,r){for(j=0;j<s.length;j++){var u=s[j];for(k=0;k<i.length;k++)i[k].name=="sSearch_"+u&&(i[k].value=l[j](),oTable.fnSettings().aoPreSearchCols[u].sSearch=i[k].value)}if(i.push({name:"sRangeSeparator",value:properties.sRangeSeparator}),e!=null)try{e(t,i,r,oTable.fnSettings())}catch(f){e(t,i,r)}else n.getJSON(t,i,function(n){r(n)})})}})}})(jQuery)